
VPATH=@top_srcdir@/src/cpp/connector/pnsd

TEAL_BUILD_COMP=build_pnsd
TEAL_INSTALL_COMP=install_pnsd
TEAL_CLEAN_COMP=clean_pnsd

TEAL_OPT_FILES = \
ibm/teal/connector/pnsd.py \
data/ibm/pnsd/xml/PNSD_GEAR_rules.xml

TEAL_XCAT_FILES = \
perl/xCAT_monitoring/rmc/resources/mn/IBM.Condition/TealAnyNodePnsdStat.pm \
perl/xCAT_monitoring/rmc/resources/mn/IBM.Condition/TealAnyNodePnsdStat_H.pm \
perl/xCAT_monitoring/rmc/resources/mn/IBM.EventResponse/TealLogPnsdEvent.pm \
perl/xCAT_monitoring/rmc/resources/mn/IBM.EventResponse/TealLogPnsdEvent_H.pm 

TEAL_XCAT_INSTALL_FILES = \
perl/xCAT_monitoring/rmc/resources/node/IBM.Sensor/TealPnsdStat.pm \
perl/xCAT_monitoring/rmc/resources/sn/IBM.Condition/TealAnyNodePnsdStat.pm

TEAL_ETC_FILES = \
etc/teal/pnsd.conf

build_pnsd: tlpnsd_sensor

clean_pnsd: 
	rm tlpnsd_sensor

install_pnsd:
	$(foreach d, $(dir $(TEAL_OPT_FILES)), $(shell mkdir -p $(RPM_BUILD_ROOT)/opt/teal/$(d)))
	$(foreach f, $(TEAL_OPT_FILES), $(shell cp $(srcdir)/$(f) $(RPM_BUILD_ROOT)/opt/teal/$(f)))

	$(foreach d, $(dir $(TEAL_ETC_FILES)), $(shell mkdir -p $(RPM_BUILD_ROOT)/$(d)))
	$(foreach f, $(TEAL_ETC_FILES), $(shell cp $(srcdir)/$(f) $(RPM_BUILD_ROOT)/$(f)))

	$(foreach d, $(dir $(TEAL_XCAT_FILES)), $(shell mkdir -p $(RPM_BUILD_ROOT)/opt/xcat/lib/$(d)))
	$(foreach f, $(TEAL_XCAT_FILES), $(shell cp $(srcdir)/$(f) $(RPM_BUILD_ROOT)/opt/xcat/lib/$(f)))

	$(foreach d, $(dir $(patsubst $(XCAT_INSTALL_SRC_DIR)/%,%,$(TEAL_XCAT_INSTALL_FILES))), $(shell mkdir -p $(XCAT_INSTALL_DIR)/$(d)))
	$(foreach f, $(TEAL_XCAT_INSTALL_FILES), $(shell cp $(srcdir)/$(f) $(XCAT_INSTALL_DIR)/$(patsubst $(XCAT_INSTALL_SRC_DIR)/%,%,$f)))
	
	@mkdir -p $(XCAT_INSTALL_DIR)/scripts
	@cp tlpnsd_sensor $(XCAT_INSTALL_DIR)/scripts
	
